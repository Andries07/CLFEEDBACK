<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>Customer Feedback Kiosk</title>
<meta name="theme-color" content="#000000">
<style>
  :root{
    --veil: rgba(255,255,255,.92);
    --accent:#f97316;
    --green:#16a34a; --green2:#22c55e; --yellow:#eab308; --orange:#f97316; --red:#dc2626;
  }
  html,body{margin:0;background:#000;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
  .hero{min-height:100dvh;background:url('./background.jpg') center/cover no-repeat fixed;display:grid;place-items:center}
  .wrap{width:min(1100px,94vw);background:var(--veil);border-radius:20px;padding:clamp(14px,3vw,28px);box-shadow:0 12px 40px rgba(0,0,0,.25)}
  h1{margin:0 0 8px 0;font-weight:800}
  .subtitle{color:#444;margin-bottom:14px}
  .q{margin:12px 0 18px}
  .q-label{font-weight:700;margin-bottom:8px}
  .grid{display:grid;grid-template-columns:repeat(5,1fr);gap:12px}
  @media (max-width:1100px){.grid{grid-template-columns:repeat(3,1fr)}}
  @media (max-width:740px){.grid{grid-template-columns:repeat(2,1fr)}}
  .choice{display:flex;align-items:center;justify-content:center;gap:8px;padding:16px 12px;border:2px solid transparent;border-radius:14px;cursor:pointer;min-height:64px;text-align:center;font-weight:800;color:#fff}
  .choice input{display:none}
  .choice[data-score="5"]{background:var(--green)}
  .choice[data-score="4"]{background:var(--green2)}
  .choice[data-score="3"]{background:var(--yellow); color:#111}
  .choice[data-score="2"]{background:var(--orange)}
  .choice[data-score="1"]{background:var(--red)}
  .choice.active{outline:3px solid rgba(255,255,255,.85)}
  .card{background:#fff;border-radius:16px;padding:14px;box-shadow:0 8px 24px rgba(0,0,0,.12)}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  @media (max-width:720px){.row{grid-template-columns:1fr}}
  input[type=text],textarea{width:100%;padding:12px;border:1.6px solid #ddd;border-radius:12px;font-size:16px;background:#fff}
  textarea{min-height:90px;resize:vertical}
  .ck{display:flex;align-items:flex-start;gap:10px}.ck input{margin-top:4px}
  .actions{display:flex;gap:12px;margin-top:16px;align-items:center}
  .btn{background:var(--accent);color:#fff;border:0;border-radius:14px;padding:14px 18px;font-weight:800;font-size:18px;cursor:pointer}
  .btn:disabled{opacity:.5;cursor:not-allowed}
  .muted{color:#666;font-size:14px}
  .thanks{position:fixed;inset:0;display:none;place-items:center;background:rgba(0,0,0,.66)}
  .thanks .inner{background:#fff;padding:24px;border-radius:18px;text-align:center;width:min(480px,92vw);box-shadow:0 16px 50px rgba(0,0,0,.4)}
  .footer{margin-top:8px;color:#444;font-size:14px;text-align:center}
</style>
</head>
<body>
  <div class="hero">
    <div class="wrap">
      <h1>Quick Service Feedback</h1>
      <div class="subtitle">Please tap one answer per question.</div>

      <div id="questions"></div>

      <div class="card" style="margin-top:16px">
        <h3>Optional details</h3>
        <div class="row">
          <input id="name" type="text" placeholder="Name (optional)">
          <input id="surname" type="text" placeholder="Surname (optional)">
        </div>
        <div class="row" style="margin-top:10px">
          <input id="phone" type="text" placeholder="Phone (optional)">
          <textarea id="feedback" placeholder="Additional feedback (optional)"></textarea>
        </div>
        <div class="ck" style="margin-top:10px">
          <input id="popia" type="checkbox">
          <label for="popia">I consent to the collection and processing of my personal information for customer service and quality feedback purposes, in accordance with the POPIA.</label>
        </div>
        <div class="muted" style="margin-top:6px">You donâ€™t need to share personal details. If you do, ticking consent is required.</div>
      </div>

      <div class="actions">
        <button id="submitBtn" class="btn" disabled>Submit</button>
        <div class="muted" id="statusTxt"></div>
      </div>

      <div class="footer" id="footer"></div>
    </div>
  </div>

  <div class="thanks" id="thanks">
    <div class="inner">
      <h2>Thank you!</h2>
      <p>Your feedback has been recorded.</p>
      <button class="btn" id="againBtn">Done</button>
    </div>
  </div>

<script>
// --------- HARD-WIRED CONFIG (no external override) ----------
const CFG = {
  apiUrl: "https://script.google.com/macros/s/AKfycbycyHFK71NRoQKlaGr7j8I22lMBymjKhK9pFqIrWSnzUcWuqpiFaTAmW4k0yenyL_4zag/exec", // <-- PASTE YOUR /exec URL
  storeId: "CL-PRETORIA-001",
  deviceLabel: "Front Counter",
  deviceId: ""
};

// --------- QUESTIONS UI (simple, reliable) ----------
const QUESTIONS=[
  {id:'Q1',text:'Speed of service'},
  {id:'Q2',text:'Friendliness of staff'},
  {id:'Q3',text:'Order accuracy'},
  {id:'Q4',text:'Cleanliness of store'},
  {id:'Q5',text:'Overall experience'}
];
const CHOICES=[
  {label:'Excellent',score:5},
  {label:'Good',     score:4},
  {label:'Average',  score:3},
  {label:'Poor',     score:2},
  {label:'Bad',      score:1}
];

function renderQuestions(){
  const qWrap=document.getElementById('questions');
  qWrap.innerHTML='';
  QUESTIONS.forEach(q=>{
    const el=document.createElement('div'); el.className='q';
    el.innerHTML=`
      <div class="q-label">${q.text}</div>
      <div class="grid" data-qid="${q.id}">
        ${CHOICES.map(c=>`
          <label class="choice" data-score="${c.score}">
            <input type="radio" name="${q.id}" value="${c.score}">
            <span class="label">${c.label}</span>
          </label>
        `).join('')}
      </div>`;
    qWrap.appendChild(el);
  });
  qWrap.querySelectorAll('.grid').forEach(grid=>{
    grid.addEventListener('click',e=>{
      const lab = e.target.closest('.choice'); if(!lab) return;
      grid.querySelectorAll('.choice').forEach(x=>x.classList.remove('active'));
      lab.classList.add('active');
      const inp=lab.querySelector('input'); if(inp) inp.checked=true;
      updateSubmitState();
    });
  });
}

function allAnswered(){
  return QUESTIONS.every(q => !!document.querySelector(`input[name="${q.id}"]:checked`));
}
function needsPOPIA(){
  return !!(document.getElementById('name').value.trim()||
            document.getElementById('surname').value.trim()||
            document.getElementById('phone').value.trim());
}
function updateSubmitState(){
  const ok = allAnswered() && (!needsPOPIA() || document.getElementById('popia').checked);
  document.getElementById('submitBtn').disabled = !ok;
}

async function onSubmit(){
  if(!allAnswered()){ document.getElementById('statusTxt').textContent='Please answer all questions'; return; }
  if(needsPOPIA() && !document.getElementById('popia').checked){
    document.getElementById('statusTxt').textContent='Please tick POPIA consent if you provide personal details'; return;
  }
  const answers = QUESTIONS.map(q=>{
    const score=Number(document.querySelector(`input[name="${q.id}"]:checked`).value);
    const choice=CHOICES.find(c=>c.score===score);
    return {questionId:q.id,choiceLabel:choice.label,choiceScore:score};
  });
  const payload = {
    storeId: CFG.storeId,
    deviceLabel: CFG.deviceLabel,
    deviceId: CFG.deviceId || '',
    pressedAtUtc: new Date().toISOString(),
    answers,
    customer:{
      name:document.getElementById('name').value.trim(),
      surname:document.getElementById('surname').value.trim(),
      phone:document.getElementById('phone').value.trim(),
      feedback:document.getElementById('feedback').value.trim(),
      consent: document.getElementById('popia').checked || null
    }
  };

  try{
    const r = await fetch(CFG.apiUrl, {
      method: 'POST',
      headers: { 'Content-Type': 'text/plain;charset=utf-8' },
      body: JSON.stringify(payload)
    });
    const txt = await r.text();
    if (!r.ok || !/\"ok\"\s*:\s*true/.test(txt)) throw new Error(txt);
    document.getElementById('thanks').style.display='grid';
    // reset UI for next user
    document.querySelectorAll('input[type=radio]').forEach(i=>i.checked=false);
    document.querySelectorAll('.choice').forEach(x=>x.classList.remove('active'));
    ['name','surname','phone','feedback'].forEach(id=>document.getElementById(id).value='');
    document.getElementById('popia').checked=false;
    updateSubmitState();
    document.getElementById('statusTxt').textContent='';
  } catch (e) {
    document.getElementById('statusTxt').textContent = 'Network/server error';
  }
}

function init(){
  renderQuestions();
  updateSubmitState();
  document.addEventListener('input',e=>{
    if(['name','surname','phone','feedback','popia'].includes(e.target.id)) updateSubmitState();
  });
  document.getElementById('submitBtn').addEventListener('click', onSubmit);
  document.getElementById('againBtn').addEventListener('click',()=>{ document.getElementById('thanks').style.display='none'; });
}
window.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>
